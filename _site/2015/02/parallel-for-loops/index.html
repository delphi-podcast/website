<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=8dce9d32f790087ba98d18ab087bc3f67f3d9fc2">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup theme-color -->
<!-- start theme color meta headers -->
<meta name="theme-color" content="#151515">
<meta name="msapplication-navbutton-color" content="#151515">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- end theme color meta headers -->


<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->


<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Parallel For Loops | The Podcast at Delphi.org</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Parallel For Loops" />
<meta name="author" content="Jim McKeeth" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Parallel For Loops are a hassle-free way to supercharge your program with the Parallel Programming Library. The syntax is similar to the standard For loop, with the advantage of each iteration running on in a different task on the thread pool. This allows multiple iterations to run at the same time, taking advantage of the multi-core and hyper-threaded architecture common on laptops, desktops and mobile devices today." />
<meta property="og:description" content="Parallel For Loops are a hassle-free way to supercharge your program with the Parallel Programming Library. The syntax is similar to the standard For loop, with the advantage of each iteration running on in a different task on the thread pool. This allows multiple iterations to run at the same time, taking advantage of the multi-core and hyper-threaded architecture common on laptops, desktops and mobile devices today." />
<link rel="canonical" href="http://localhost:4000/2015/02/parallel-for-loops/" />
<meta property="og:url" content="http://localhost:4000/2015/02/parallel-for-loops/" />
<meta property="og:site_name" content="The Podcast at Delphi.org" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-02-03T06:11:41-07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Parallel For Loops" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jim McKeeth"},"dateModified":"2015-02-03T06:11:41-07:00","datePublished":"2015-02-03T06:11:41-07:00","description":"Parallel For Loops are a hassle-free way to supercharge your program with the Parallel Programming Library. The syntax is similar to the standard For loop, with the advantage of each iteration running on in a different task on the thread pool. This allows multiple iterations to run at the same time, taking advantage of the multi-core and hyper-threaded architecture common on laptops, desktops and mobile devices today.","headline":"Parallel For Loops","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2015/02/parallel-for-loops/"},"url":"http://localhost:4000/2015/02/parallel-for-loops/"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <header>
      <div class="container">
        <a id="a-title" href="/">
          <h1>delphiorg.github.io</h1>
        </a>
        <h2>The Podcast about the Delphi programming language, tools, news and community.</h2>

        <section id="downloads">
          
          <a href="https://github.com/delphiorg/delphiorg.github.io" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <small>3 February 2015</small>
<h1>Parallel For Loops</h1>

<p class="view">by Jim McKeeth</p>

<p><a href="http://docwiki.embarcadero.com/RADStudio/XE7/en/Using_TParallel.For_from_the_Parallel_Programming_Library%20">Parallel For Loops</a> are a hassle-free way to supercharge your program with the Parallel Programming Library. The syntax is similar to the standard <strong>For</strong> loop, with the advantage of each iteration running on in a different task on the thread pool. This allows multiple iterations to run at the same time, taking advantage of the multi-core and hyper-threaded architecture common on laptops, desktops and mobile devices today.</p>

<p>Here is the replay of the Skill Sprint:</p>

<p>[embed]https://www.youtube.com/watch?v=uZ79t4bSM1w[/embed]</p>
<p class="p1">Here are the slides:</p>
<p>[embed]http://www.slideshare.net/slideshow/embed_code/44464343[/embed]</p>
<p class="p1"><strong>Update:</strong> I was chatting with Allen Bauer today and he mentioned that while you technically can use Queue and Synchronize from within a Parallel For loop, he wouldn't recommend it because it will dramatically reduce the speed of the loop. It is still faster than a linear loop, but not as fast as it could be. I'll leave these examples here, but keep that in mind when optimizing your parallel code.</p>
<p>Here is the syntax in Object Pascal. The stride is the first parameter is it is optional. It controls how the iterations are grouped when being sent to the CPUs. Min and Max are your usual start and stop range for the loop. The last parameter is an anonymous method that represents the code to be executed on each iterations. It takes an Index parameter that is either an Integer or Int64 that provides the value of the current iteration.</p>

<p>[delphi]
TParallel.For(Stride, Min, Max, procedure (Idx: Integer)
begin
  if IsPrime(Idx) then
  begin
    TInterlocked.Increment (Tot);
    TThread.Queue(TThread.CurrentThread, procedure
    begin
      Memo1.Lines.Add(Idx.ToString);
    end);
  end;
end);
[/delphi]</p>

<p>Here is the C++ code syntax. It takes a event instead of an anonymous method.</p>

<p>[cpp]
// . . .
TParallel::For(NULL, Min, Max, MyIteratorEvent);
// . . .</p>

<p>void __fastcall TFormThreading::MyIteratorEvent(TObject *Sender, int AIndex)
{
	if(IsPrime(AIndex)){
		TInterlocked::Increment(Tot);
	};
}
[/cpp]</p>

<p><strong>There are some great blog posts and videos on the Parallel Programming Library</strong></p>

<p><a href="http://delphiaball.co.uk/">Stephen Ball</a> has a series of blog posts on the <a href="http://delphiaball.co.uk/tag/parallel-programming/%20">Parallel Programming Library</a>, including a <a href="http://delphiaball.co.uk/2014/09/05/quick-introduction-to-parallel-programming-with-xe7/">Quick Introduction</a> and one on <a href="http://delphiaball.co.uk/2014/09/23/parallel-programming-thread-pool/">managing the thread pool</a>. As Stephen points out, while you can customize the thread pool, that doesn’t alway mean you should. <a href="http://www.malcolmgroves.com/blog/">Malcolm Groves</a> also has some great <a href="http://www.malcolmgroves.com/blog/?cat=109">blog posts on PPL</a>.</p>

<p><a href="http://dannywind.nl/">Danny Wind</a> has a great Code Rage 9 session on the <a href="http://dannywind.nl/delphi/coderage9/%20">Parallel Programming Library</a> (be sure to <a href="http://dannywind.nl/assets/images/2014/10/DelphiParallelLibrary_CreateResponsiveApps_DannyWind.zip">download his samples</a>). <em>David I. did the <a href="https://www.youtube.com/watch?v=QJeKfJHbwUk">C++ version</a></em>.</p>

<p>https://www.youtube.com/watch?v=rZfux4by0po&#038;rel=0</p>

<p>Allen Bauer, our Chief Scientist, also has a CodeRage 9 session on the <a href="https://www.youtube.com/watch?v=4_PB5bnapXw">PPL Architecture</a>.</p>

<p>https://www.youtube.com/watch?v=4_PB5bnapXw&#038;rel=0</p>

<p>If you want to take advantage of the new C++11 Lambda syntax on Win64 and mobile, then check out <a href="http://community.embarcadero.com/index.php/article/technical-articles/1044-coderage-9-snippet-consuming-object-pascal-code-from-c-apps-using-c-11-lambdas">this community article</a> or watch this <a href="https://www.youtube.com/watch?v=Q8Mpkn303BE">CodeRage 9 video snippet</a>. Get <a href="http://delphi.org/downloads/CppParallelExamples.zip">Bruneau and David’s code for C++ and Parallel libraries</a>.</p>

<p>https://www.youtube.com/watch?v=Q8Mpkn303BE&#038;rel=0</p>

<p>Update: Keep in mind that a Parallel For loop isn’t always the best performance option, but it is really easy to use. Check out <a href="http://stackoverflow.com/a/27542557/255">Stefan Glienke’s Stack Overflow answer</a> for an alternative using the PPL TTask for even better performance.</p>



  <small>tags: <em>Architecture</em> - <em>iOS</em> - <em>Mobile</em> - <em>Source Code</em></small>


      </section>
    </div>
  </body>
</html>
