<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=8dce9d32f790087ba98d18ab087bc3f67f3d9fc2">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup theme-color -->
<!-- start theme color meta headers -->
<meta name="theme-color" content="#151515">
<meta name="msapplication-navbutton-color" content="#151515">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- end theme color meta headers -->


<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->


<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Buffering Sensor Data | The Podcast at Delphi.org</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Buffering Sensor Data" />
<meta name="author" content="Jim McKeeth" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Working with sensors on devices can often lead to large amounts of data coming to you really fast. For example the TMotionSensor’s OnDataChange event fires 100 times a second on my Nexus 5. When I was building my level app for Google Glass the level bar was bouncing all over the place because of the sensitivity and sample rate." />
<meta property="og:description" content="Working with sensors on devices can often lead to large amounts of data coming to you really fast. For example the TMotionSensor’s OnDataChange event fires 100 times a second on my Nexus 5. When I was building my level app for Google Glass the level bar was bouncing all over the place because of the sensitivity and sample rate." />
<link rel="canonical" href="http://localhost:4000/2014/01/buffering-sensor-data/" />
<meta property="og:url" content="http://localhost:4000/2014/01/buffering-sensor-data/" />
<meta property="og:site_name" content="The Podcast at Delphi.org" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-01-16T15:33:41-07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Buffering Sensor Data" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jim McKeeth"},"dateModified":"2014-01-16T15:33:41-07:00","datePublished":"2014-01-16T15:33:41-07:00","description":"Working with sensors on devices can often lead to large amounts of data coming to you really fast. For example the TMotionSensor’s OnDataChange event fires 100 times a second on my Nexus 5. When I was building my level app for Google Glass the level bar was bouncing all over the place because of the sensitivity and sample rate.","headline":"Buffering Sensor Data","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2014/01/buffering-sensor-data/"},"url":"http://localhost:4000/2014/01/buffering-sensor-data/"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <header>
      <div class="container">
        <a id="a-title" href="/">
          <h1>delphiorg.github.io</h1>
        </a>
        <h2>The Podcast about the Delphi programming language, tools, news and community.</h2>

        <section id="downloads">
          
          <a href="https://github.com/delphiorg/delphiorg.github.io" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <small>16 January 2014</small>
<h1>Buffering Sensor Data</h1>

<p class="view">by Jim McKeeth</p>

<p>Working with sensors on devices can often lead to large amounts of data coming to you really fast. For example the TMotionSensor’s OnDataChange event fires 100 times a second on my Nexus 5. When I was building my <a href="http://delphi.org/2014/01/launching-a-delphi-xe5-app-via-voice-on-google-glass/">level app for Google Glass</a> the level bar was bouncing all over the place because of the sensitivity and sample rate.</p>

<p>My first thought was to only take every 10th sample, but I wasn’t happy with that either because the specific sample it pulled could be the one when there was a jitter.</p>

<p><em>Example</em>: <strong>1</strong>,2,1,1,2,1,2,3,1,3,<strong>12</strong>,2,3,1</p>

<p>If I just looked at sample 1 and 11 then I would see a lot of movement, but in reality it was relatively stable most of the time.</p>

<p>What I ended up doing was buffering the data and taking an average. I just created a generic <strong>TList</strong> of the appropriate type, and during the <strong>OnDataChange</strong> event I would simply store the sample data. When it came time to update the display I took an average sample, which I found gave a much smoother and more representational display.</p>

<p>Although it was still possible the line could jump erratically if I really moved a lot. So I decided to use an animation for the movement. This keeps the line movement smooth, even if there is a lot of movement (it interpolates the positions between the current line position and the new position). I used a <strong>TFloatAnimation</strong> and set the <strong>StartFromCurrent</strong> property to true.</p>

<p>When the animation is finished I set the <strong>StopValue</strong> to the the average of the values, then enable again. It is important to always clear the sample values after taking an average. Otherwise the movement will continue to get slower and slower as it becomes more and more stable (averaging a large enough sample of numbers results in a smaller range of results.)</p>

<p>I was really pleased with how smooth things looked with a 0.1 second duration on the animation. With 100 samples a second, this translates into each animation covering the average of 10 samples. The built in animations made it really easy, and the final display looked great.</p>

<p>I’ll include the source code with the downloads from the <a href="http://forms.embarcadero.com/DevicesWebinar1-22"><strong>Making the Connection: Programming Devices and Gadgets with RAD Studio</strong></a> webinar coming up next week!</p>

<p><a href="http://forms.embarcadero.com/DevicesWebinar1-22"><img class="alignnone" alt="RAD-in-Action Webinar Making the Connection: Programming Devices and Gadgets with RAD Studio Wednesday, January 22, 2014" src="http://img.en25.com/EloquaImages/clients/Embarcadero/%7Bbdf8dda7-28a8-449b-9a5a-23cf781bd523%7D_RADInAction_Devices_680x150.jpg" width="680" height="150" /></a></p>



  <small>tags: <em>iOS</em> - <em>Mobile</em> - <em>webinar</em></small>


      </section>
    </div>
  </body>
</html>
