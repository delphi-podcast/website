<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=8dce9d32f790087ba98d18ab087bc3f67f3d9fc2">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup theme-color -->
<!-- start theme color meta headers -->
<meta name="theme-color" content="#151515">
<meta name="msapplication-navbutton-color" content="#151515">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- end theme color meta headers -->


<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->


<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>API Limits with #FDEC | The Podcast at Delphi.org</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="API Limits with #FDEC" />
<meta name="author" content="Jim McKeeth" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The FireDAC Enterprise Connectors (#FDEC) by CData and Embarcadero make it really easy to work with various APIs just like you would any SQL database. For example if you want to publish the results of a query to a Google Sheet (which I find incredibly useful) then it is just a few FireDAC components and you are off to the races. You might run into an API limit though." />
<meta property="og:description" content="The FireDAC Enterprise Connectors (#FDEC) by CData and Embarcadero make it really easy to work with various APIs just like you would any SQL database. For example if you want to publish the results of a query to a Google Sheet (which I find incredibly useful) then it is just a few FireDAC components and you are off to the races. You might run into an API limit though." />
<link rel="canonical" href="http://localhost:4000/2018/08/api-limits-with-fdec/" />
<meta property="og:url" content="http://localhost:4000/2018/08/api-limits-with-fdec/" />
<meta property="og:site_name" content="The Podcast at Delphi.org" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-31T17:58:08-06:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="API Limits with #FDEC" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jim McKeeth"},"dateModified":"2018-08-31T17:58:08-06:00","datePublished":"2018-08-31T17:58:08-06:00","description":"The FireDAC Enterprise Connectors (#FDEC) by CData and Embarcadero make it really easy to work with various APIs just like you would any SQL database. For example if you want to publish the results of a query to a Google Sheet (which I find incredibly useful) then it is just a few FireDAC components and you are off to the races. You might run into an API limit though.","headline":"API Limits with #FDEC","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2018/08/api-limits-with-fdec/"},"url":"http://localhost:4000/2018/08/api-limits-with-fdec/"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <header>
      <div class="container">
        <a id="a-title" href="/">
          <h1>delphiorg.github.io</h1>
        </a>
        <h2>The Podcast about the Delphi programming language, tools, news and community.</h2>

        <section id="downloads">
          
          <a href="https://github.com/delphiorg/delphiorg.github.io" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <small>31 August 2018</small>
<h1>API Limits with #FDEC</h1>

<p class="view">by Jim McKeeth</p>

<p><img class="size-medium wp-image-3136 alignright" src="/assets/images/2018/08/API-Limits-300x300.png" alt="API Limits with FireDAC Enterprise Connectors" width="300" height="300" />The FireDAC Enterprise Connectors (#FDEC) by CData and Embarcadero make it really easy to work with various APIs just like you would any SQL database. For example if you want to publish the results of a query to a Google Sheet (which I find incredibly useful) then it is just a few FireDAC components and you are off to the races. You might run into an API limit though.</p>

<p>What is an API limit? Most rest services have a limit to how often a client can call a specific API within a certain amount of time. Google calls this their <a href="https://developers.google.com/sheets/api/limits">usage limit</a>:</p>
<blockquote>This version of the Google Sheets API has a limit of 500 requests per 100 seconds per project, and 100 requests per 100 seconds per user. Limits for reads and writes are tracked separately. There is no daily usage limit.</blockquote>
<p>That may seem like a lot, but I found I was running into that limit pretty quick once I moved my project into production. Luckily FireDAC and the FireDAC Enterprise Connectors have a simple workaround: Batch Processing.</p>

<p>Using the <a href="http://docwiki.embarcadero.com/RADStudio/en/Array_DML_(FireDAC)">Array DML</a> features of FireDAC you can batch multiple DML (Data Manipulation Language) operations into a single API call. The <a href="http://cdn.cdata.com/help/RLC/fire/pg_usagef.htm">FDEC Google Sheets documentation</a> from CData doesn’t cover Array DML, but the component supports this (they are updating the documentation). The Elasticsearch documentation does cover <a href="http://cdn.cdata.com/help/EED/fire/pg_FIREbatch.htm">Batch Processing</a> with an example, and I’ve used this with Sheets and it works great!</p>
<h2>Bulk Insert</h2>
<p>The following example prepares a single batch that inserts records in bulk.</p>

<p>[delphi]FDConnection1.ResourceOptions.ServerOutput := True;
FDQuery1.SQL.Text := ’insert into Account values (:Name, :Id )’;
FDQuery1.Params.ArraySize := 100;
FDQuery1.Params[0].AsStrings[0]:= ’MyName1’;
FDQuery1.Params[1].AsStrings[0]:= ’MyId1’;</p>

<p>//next statement
FDQuery1.Params[0].AsStrings[1]:= ’MyName2’;
FDQuery1.Params[1].AsStrings[1]:= ’MyId2’;
…</p>

<p>FDQuery1.Execute(FDQuery1.Params.ArraySize);
ShowMessage(IntToStr(FDQuery1.RowsAffected));[/delphi]</p>

<p>To retrieve the Ids of the new records, query the LastResultInfo#TEMP table:</p>

<p>[pascal]sName := FDQuery1.Open(‘SELECT * FROM [LastResultInfo#TEMP]’);[/pascal]</p>

<h2>Bulk Update</h2>
<p>The following example prepares a single batch that inserts records in bulk.</p>

<p>[delphi]FDQuery1.SQL.Text := ’update Account set Name = :Name WHERE Id = :Id’;
FDQuery1.Params.ArraySize := 100;
FDQuery1.Params[0].AsStrings[0]:= ’Floppy Disks’;
FDQuery1.Params[1].AsStrings[0]:= ’Id1’;</p>

<p>//next statement
FDQuery1.Params[0].AsStrings[1]:= ’Jon Doe’;
FDQuery1.Params[1].AsStrings[1]:= ’Id2’;
…</p>

<p>FDQuery1.Execute(FDQuery.Params.ArraySize);
ShowMessage(IntToStr(FDQuery1.RowsAffected));[/delphi]</p>

<h2>Bulk Delete</h2>
<p>The following example prepares a single batch that inserts records in bulk:</p>

<p>[delphi]FDQuery1.SQL.Text := ’delete Account where Id = :Id’;
FDQuery1.Params.ArraySize := 100;
FDQuery1.Params[0].AsStrings[0]:= ’MyId1’;</p>

<p>//next statement
FDQuery1.Params[0].AsStrings[1]:= ’MyId2’;
…</p>

<p>FDQuery1.Execute(FDQuery.Params.ArraySize);
ShowMessage(IntToStr(FDQuery1.RowsAffected));[/delphi]</p>

<p>If you want to learn more about <a href="http://docwiki.embarcadero.com/RADStudio/en/Array_DML_(FireDAC)">Array DML</a> check out these videos:</p>

<p><a href="https://www.youtube.com/watch?v=S58Xv2TH5M0">Array DML Skill Sprint with Pawel Glowacki</a></p>

<p>https://www.youtube.com/watch?v=S58Xv2TH5M0</p>

<p><a href="https://www.youtube.com/watch?v=wS1A3v5_l98">FireDAC in Depth with Cary Jensen</a></p>

<p>https://www.youtube.com/watch?v=wS1A3v5_l98</p>

<p>Also check out <a href="http://www.jensendatasystems.com/firedacbook/">Cary Jensen’s book on the topic of FireDAC in Depth</a>.</p>



  <small>tags: <em>Cloud</em> - <em>FireDAC</em> - <em>News</em> - <em>Source Code</em></small>


      </section>
    </div>
  </body>
</html>
